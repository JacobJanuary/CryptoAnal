<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Фильтрованные криптовалюты (CoinGecko)</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='main.js') }}"></script>
</head>
<body>
    <h1>Фильтрованные криптовалюты (CoinGecko)</h1>
    {% if crypto_data %}
    <div id="table-container">
        <table id="cryptoTable">
            <thead>
                <tr>
                    <th data-type="string" onclick="sortTable(0, 'string')">Name (Symbol)</th>
                    <th data-type="number" onclick="sortTable(1, 'number')">Rank</th>
                    <th data-type="number" onclick="sortTable(2, 'number')">Current Volume</th>
                    <th data-type="percent" onclick="sortTable(3, 'percent')">Vol Growth (6ч)</th>
                    <th data-type="percent" onclick="sortTable(4, 'percent')">Vol Growth (1ч)</th>
                    <th data-type="percent" onclick="sortTable(5, 'percent')">Price Change (6ч)</th>
                    <th data-type="number" onclick="sortTable(6, 'number')">Current Price</th>
                    <th>Coingecko</th>
                    <th>AI Аналитика</th>
                    <th>Избранное</th>
                </tr>
            </thead>
            <tbody>
                {% for crypto in crypto_data %}
                <tr>
                    <td>{{ crypto.name }} ({{ crypto.symbol }})</td>
                    <td>{{ crypto.market_cap_rank }}</td>
                    <td>{{ crypto.vol_latest }}</td>
                    <td>{{ crypto.vol_growth_6h|round(2) }}%</td>
                    <td>{{ crypto.vol_growth_1h|round(2) }}%</td>
                    <td>{{ crypto.price_change_6h|round(2) }}%</td>
                    <td>{{ crypto.current_price }}</td>
                    <td>
                        <a href="https://www.coingecko.com/en/coins/{{ crypto.coin_id }}" target="_blank">
                            Ссылка
                        </a>
                    </td>
                    <td>
                        <button onclick="showAIAnalytics('{{ crypto.name }}', '{{ crypto.symbol }}')" class="ai-analytics">
                            AI Аналитика
                        </button>
                    </td>
                    <td>
                        <button id="favorite-button-{{ crypto.coin_id }}"
                                onclick="toggleFavorite('{{ crypto.coin_id }}', {{ 'true' if crypto.isFavourites else 'false' }})">
                            {% if crypto.isFavourites %}
                                Удалить
                            {% else %}
                                Добавить
                            {% endif %}
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p>Всего криптовалют: {{ crypto_data|length }}</p>
    {% else %}
    <p>Нет данных для отображения.</p>
    {% endif %}
    <div id="modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title"></h3>
        <div id="modal-loading">
            <div class="loader"></div>
            <p>ИИ анализирует информацию. Подождите...</p>
        </div>
        <div id="modal-content-data" style="display: none;"></div>
        <button id="close-modal">Закрыть</button>
    </div>
    </div>
</body>
</html>